module.exports=[34699,a=>{"use strict";var b=a.i(34445);a.i(52434);var c=a.i(13422),d=a.i(80494);async function e(){try{let a=await (0,b.headers)(),e=a.get("host")||a.get("x-forwarded-host");if(e){let a=e.split(":")[0].split(".");if(a.length>2){let b=a[0],c=(0,d.supabaseServer)(),{data:e,error:f}=await c.from("tenants").select("id").eq("slug",b).maybeSingle();if(e&&!f)return e.id}}let f=await (0,b.cookies)(),g=(0,c.createServerClient)("https://qgisnksjztjczsrbjryr.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFnaXNua3NqenRqY3pzcmJqcnlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwNTI0ODcsImV4cCI6MjA4MDYyODQ4N30.B9j69ZAWHxEKvgJC0B_4iVtj45h2USfbWWssIQCx_DA",{cookies:{get:a=>f.get(a)?.value}}),{data:{user:h}}=await g.auth.getUser();if(h){let{data:a,error:b}=await g.from("tenant_users").select("tenant_id").eq("user_id",h.id).limit(1).maybeSingle();if(a?.tenant_id&&!b)return a.tenant_id}let i=(0,d.supabaseServer)(),{data:j,error:k}=await i.from("tenants").select("id").eq("slug","kalitechnia").maybeSingle();if(j&&!k)return j.id;return null}catch(a){return console.error("Error getting tenant ID:",a),null}}a.s(["getTenantIdForServerAction",()=>e])},89290,a=>{"use strict";var b=a.i(34445);async function c(){let a=await (0,b.headers)(),c=a.get("host")||a.get("x-forwarded-host");if(!c)return null;let d=c.split(":")[0],e=d.split(".");return e.length>2?e[0]:null}a.s(["getTenantId",()=>c])},46528,a=>{"use strict";var b=a.i(64898),c=a.i(80494),d=a.i(89290),e=a.i(34699),f=a.i(93879);async function g(a){try{let b=await (0,d.getTenantId)();if(!b)return{error:"Tenant not found"};let e=(0,c.supabaseServer)(),{data:f,error:g}=await e.from("tenants").select("id").eq("slug",b).single();if(g||!f)return{error:"Tenant not found"};let{data:h,error:i}=await e.from("pages").select("*").eq("tenant_id",f.id).eq("id",a).single();if(i)return{error:i.message};let j=null;if(h){let{data:a}=await e.from("page_versions").select("content").eq("page_id",h.id).order("version_number",{ascending:!1}).limit(1).single();j=a?.content||null}return{data:{...h,content:j}}}catch(a){return{error:a instanceof Error?a.message:"Unknown error"}}}async function h(a){try{let b=await (0,d.getTenantId)();if(!b)return{error:"Tenant not found"};let e=(0,c.supabaseServer)(),{data:f,error:g}=await e.from("tenants").select("id").eq("slug",b).single();if(g||!f)return{error:"Tenant not found"};let{data:h,error:i}=await e.from("pages").select("*").eq("tenant_id",f.id).eq("slug",a).single();if(i)return{error:i.message};let j=null;if(h){let{data:a}=await e.from("page_versions").select("content").eq("page_id",h.id).order("version_number",{ascending:!1}).limit(1).single();j=a?.content||null}return{data:{...h,content:j}}}catch(a){return{error:a instanceof Error?a.message:"Unknown error"}}}async function i(a,b){try{let e=await (0,d.getTenantId)();if(!e)return{error:"Tenant not found"};let g=(0,c.supabaseServer)(),{data:h,error:i}=await g.from("tenants").select("id").eq("slug",e).single();if(i||!h)return{error:"Tenant not found"};let{data:j,error:k}=await g.from("pages").select("id, tenant_id").eq("id",a).eq("tenant_id",h.id).single();if(k||!j)return{error:"Page not found"};let{data:l}=await g.from("page_versions").select("version_number").eq("page_id",a).order("version_number",{ascending:!1}).limit(1).single(),m=(l?.version_number||0)+1,{data:n,error:o}=await g.from("page_versions").insert({page_id:a,tenant_id:h.id,version_number:m,content:{sections:b}}).select().single();if(o)return{error:o.message};return(0,f.revalidatePath)("/"),{data:n}}catch(a){return{error:a instanceof Error?a.message:"Unknown error"}}}async function j(a,b){let{error:d}=await (0,c.supabaseServer)().from("pages").update({status:"published"}).eq("id",a);if(d)throw Error(d.message);return await fetch(`https://${b}/api/revalidate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({secret:process.env.VERCEL_REVALIDATE_SECRET,tenantDomain:b})}).catch(()=>{}),{ok:!0}}async function k(a){try{let b=await (0,d.getTenantId)();if(!b)return{error:"Tenant not found"};let e=(0,c.supabaseServer)(),{data:g,error:h}=await e.from("tenants").select("id").eq("slug",b).single();if(h||!g)return{error:"Tenant not found"};let{data:i,error:j}=await e.from("pages").update({status:"draft"}).eq("id",a).eq("tenant_id",g.id).select().single();if(j)return{error:j.message};return(0,f.revalidatePath)("/"),{data:i}}catch(a){return{error:a instanceof Error?a.message:"Unknown error"}}}async function l(a,b,e){try{let g=await (0,d.getTenantId)();if(!g)return{error:"Tenant not found"};let h=(0,c.supabaseServer)(),{data:i,error:j}=await h.from("tenants").select("id").eq("slug",g).single();if(j||!i)return{error:"Tenant not found"};let{data:k,error:l}=await h.from("pages").select("*").eq("id",a).eq("tenant_id",i.id).single();if(l||!k)return{error:"Page not found"};let{data:m}=await h.from("page_versions").select("content").eq("page_id",a).order("version_number",{ascending:!1}).limit(1).single(),{data:n,error:o}=await h.from("pages").insert({tenant_id:i.id,slug:b,title:e||`${k.title} (Copy)`,status:"draft"}).select().single();if(o)return{error:o.message};return m&&await h.from("page_versions").insert({page_id:n.id,tenant_id:i.id,version_number:1,content:m.content}),(0,f.revalidatePath)("/"),{data:n}}catch(a){return{error:a instanceof Error?a.message:"Unknown error"}}}async function m(a){try{let b=await (0,d.getTenantId)();if(!b)return{error:"Tenant not found"};let e=(0,c.supabaseServer)(),{data:f,error:g}=await e.from("tenants").select("id").eq("slug",b).single();if(g||!f)return{error:"Tenant not found"};let{data:h,error:i}=await e.from("pages").select("id").eq("id",a).eq("tenant_id",f.id).single();if(i||!h)return{error:"Page not found"};let{data:j,error:k}=await e.from("page_versions").select("*").eq("page_id",a).order("version_number",{ascending:!1});if(k)return{error:k.message};return{data:j||[]}}catch(a){return{error:a instanceof Error?a.message:"Unknown error"}}}async function n(a){try{let b=await (0,e.getTenantIdForServerAction)();if(!b)return{error:"Tenant not found"};let d=(0,c.supabaseServer)(),{data:g,error:h}=await d.from("pages").insert({tenant_id:b,title:a.title,slug:a.slug,status:"draft"}).select().single();if(h)return{error:h.message};return await d.from("page_versions").insert({page_id:g.id,tenant_id:b,version_number:1,content:{sections:[]}}),(0,f.revalidatePath)("/"),{data:g}}catch(a){return{error:a instanceof Error?a.message:"Unknown error"}}}async function o(){try{let a=await (0,e.getTenantIdForServerAction)();if(!a)return{error:"Tenant not found"};let b=(0,c.supabaseServer)(),{data:d,error:f}=await b.from("pages").select("id, title, slug, status, updated_at").eq("tenant_id",a).order("updated_at",{ascending:!1});if(f)return{error:f.message};return{data:d||[]}}catch(a){return{error:a instanceof Error?a.message:"Unknown error"}}}async function p(a,b){try{let e=await (0,d.getTenantId)();if(!e)return{error:"Tenant not found"};let g=(0,c.supabaseServer)(),{data:h,error:i}=await g.from("tenants").select("id").eq("slug",e).single();if(i||!h)return{error:"Tenant not found"};let{data:j,error:k}=await g.from("pages").select("id").eq("id",a).eq("tenant_id",h.id).single();if(k||!j)return{error:"Page not found"};let{data:l,error:m}=await g.from("page_versions").select("*").eq("id",b).eq("page_id",a).single();if(m||!l)return{error:"Version not found"};let{data:n}=await g.from("page_versions").select("version_number").eq("page_id",a).order("version_number",{ascending:!1}).limit(1).single(),o=(n?.version_number||0)+1,{data:p,error:q}=await g.from("page_versions").insert({page_id:a,tenant_id:h.id,version_number:o,content:l.content,meta:{...l.meta,restored_from:b,restored_at:new Date().toISOString()}}).select().single();if(q)return{error:q.message};return(0,f.revalidatePath)("/"),{data:p}}catch(a){return{error:a instanceof Error?a.message:"Unknown error"}}}(0,a.i(57097).ensureServerEntryExports)([g,h,i,j,k,l,m,n,o,p]),(0,b.registerServerReference)(g,"400e01962a7ba0b6d9a0002023117407ac1d94d220",null),(0,b.registerServerReference)(h,"4064bb847bae73a6bb724094516382f07864270135",null),(0,b.registerServerReference)(i,"606337134726a34315762e8a1843d4f6a808673ebd",null),(0,b.registerServerReference)(j,"60330e4ad25524ca961fa57c492378a9a003f27630",null),(0,b.registerServerReference)(k,"407e66a1d95a9cbf5286e8d93fcf603ab8c12c6e56",null),(0,b.registerServerReference)(l,"7098c75cf086c19615e40c69c896dfd7bffd7aef1f",null),(0,b.registerServerReference)(m,"40343656f0cad607e3b093a978652ba0d914968fc4",null),(0,b.registerServerReference)(n,"401ddc1eaf1c83c84f1fc2a9c4ac40fa2c1918d003",null),(0,b.registerServerReference)(o,"00d5ae8343e5d93dbe43286610e7bb2543fe2c9ca9",null),(0,b.registerServerReference)(p,"60f8459ed7bbb7825dbbfc0603c871ca9222443ad3",null),a.s(["clonePage",()=>l,"listPages",()=>o,"listVersions",()=>m,"publishPage",()=>j,"restoreVersion",()=>p,"savePageSections",()=>i,"setDraft",()=>k])},30545,a=>{"use strict";var b=a.i(64898),c=a.i(80494),d=a.i(89290);async function e(a,b){try{let d=(0,c.supabaseServer)(),e=Date.now(),f=Math.random().toString(36).substring(2,15),g=a.name.split(".").pop(),h=`${e}-${f}.${g}`,i=`/${b}/uploads/${h}`,j=await a.arrayBuffer(),{data:k,error:l}=await d.storage.from("public").upload(i,j,{contentType:a.type,upsert:!0});if(l)return{error:l.message};let{data:{publicUrl:m}}=d.storage.from("public").getPublicUrl(i);return{data:{url:m,path:i}}}catch(a){return{error:a instanceof Error?a.message:"Unknown error"}}}async function f(a){try{let b=await (0,d.getTenantId)();if(!b)return{error:"Tenant not found"};let f=(0,c.supabaseServer)(),{data:g,error:h}=await f.from("tenants").select("id").eq("slug",b).single();if(h||!g)return{error:"Tenant not found"};return e(a,g.id)}catch(a){return{error:a instanceof Error?a.message:"Unknown error"}}}(0,a.i(57097).ensureServerEntryExports)([e,f]),(0,b.registerServerReference)(e,"6046574415eb8cd38fce46e1ee3145ea2f0d317fdb",null),(0,b.registerServerReference)(f,"40cb90cc8455bf9fab79982c9ca1cf8596507845fc",null),a.s(["uploadImageForTenant",()=>f])},84677,a=>{"use strict";var b=a.i(46528),c=a.i(30545);a.s([],53154),a.i(53154),a.s(["00d5ae8343e5d93dbe43286610e7bb2543fe2c9ca9",()=>b.listPages,"40343656f0cad607e3b093a978652ba0d914968fc4",()=>b.listVersions,"407e66a1d95a9cbf5286e8d93fcf603ab8c12c6e56",()=>b.setDraft,"40cb90cc8455bf9fab79982c9ca1cf8596507845fc",()=>c.uploadImageForTenant,"60330e4ad25524ca961fa57c492378a9a003f27630",()=>b.publishPage,"606337134726a34315762e8a1843d4f6a808673ebd",()=>b.savePageSections,"60f8459ed7bbb7825dbbfc0603c871ca9222443ad3",()=>b.restoreVersion,"7098c75cf086c19615e40c69c896dfd7bffd7aef1f",()=>b.clonePage],84677)}];

//# sourceMappingURL=_a6e02d4e._.js.map