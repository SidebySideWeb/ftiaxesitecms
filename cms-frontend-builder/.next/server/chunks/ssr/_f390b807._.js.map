{"version":3,"sources":["../../../../../src/lib/tenant-server.ts","../../../../../src/lib/tenant.ts","../../../../../src/actions/pages.ts","../../../../../cms-frontend-builder/.next-internal/server/app/%28cms%29/pages/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["import { headers } from \"next/headers\";\r\nimport { cookies } from \"next/headers\";\r\nimport { createServerClient } from \"@supabase/ssr\";\r\nimport { supabaseServer } from \"./supabase\";\r\n\r\n/**\r\n * Gets the tenant ID for the current request.\r\n * Tries multiple strategies:\r\n * 1. From host subdomain (production)\r\n * 2. From user's session via tenant_users table (development/localhost)\r\n * 3. Default tenant \"kalitechnia\" as fallback\r\n */\r\nexport async function getTenantIdForServerAction(): Promise<string | null> {\r\n  try {\r\n    // Strategy 1: Try to get from host subdomain\r\n    const headersList = await headers();\r\n    const host = headersList.get(\"host\") || headersList.get(\"x-forwarded-host\");\r\n\r\n    if (host) {\r\n      const hostname = host.split(\":\")[0];\r\n      const parts = hostname.split(\".\");\r\n\r\n      // If we have a subdomain (more than 2 parts), use it\r\n      if (parts.length > 2) {\r\n        const tenantSlug = parts[0];\r\n        const supabase = supabaseServer();\r\n        const { data: tenant, error } = await supabase\r\n          .from(\"tenants\")\r\n          .select(\"id\")\r\n          .eq(\"slug\", tenantSlug)\r\n          .maybeSingle();\r\n\r\n        if (tenant && !error) {\r\n          return tenant.id;\r\n        }\r\n      }\r\n    }\r\n\r\n    // Strategy 2: Get from user's session (for localhost/development)\r\n    const cookieStore = await cookies();\r\n    const supabase = createServerClient(\r\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n      {\r\n        cookies: {\r\n          get(name: string) {\r\n            return cookieStore.get(name)?.value;\r\n          },\r\n        },\r\n      }\r\n    );\r\n\r\n    const { data: { user } } = await supabase.auth.getUser();\r\n\r\n    if (user) {\r\n      // Get user's first tenant from tenant_users\r\n      const { data: tenantUser, error: tenantUserError } = await supabase\r\n        .from(\"tenant_users\")\r\n        .select(\"tenant_id\")\r\n        .eq(\"user_id\", user.id)\r\n        .limit(1)\r\n        .maybeSingle();\r\n\r\n      if (tenantUser?.tenant_id && !tenantUserError) {\r\n        return tenantUser.tenant_id;\r\n      }\r\n    }\r\n\r\n    // Strategy 3: Fallback to default tenant \"kalitechnia\"\r\n    const supabaseAdmin = supabaseServer();\r\n    const { data: defaultTenant, error: defaultTenantError } = await supabaseAdmin\r\n      .from(\"tenants\")\r\n      .select(\"id\")\r\n      .eq(\"slug\", \"kalitechnia\")\r\n      .maybeSingle();\r\n\r\n    if (defaultTenant && !defaultTenantError) {\r\n      return defaultTenant.id;\r\n    }\r\n\r\n    return null;\r\n  } catch (error) {\r\n    console.error(\"Error getting tenant ID:\", error);\r\n    return null;\r\n  }\r\n}\r\n\r\n","import { headers } from \"next/headers\";\r\n\r\n/**\r\n * Extracts the tenant ID from the host subdomain.\r\n * SERVER-ONLY: Use this in Server Components, Server Actions, and API routes.\r\n * \r\n * Example: kalitechnia.ftiaxesite.gr â†’ \"kalitechnia\"\r\n * Example: localhost:3000 â†’ null (no subdomain in development)\r\n * \r\n * @returns The tenant ID (subdomain) or null if no subdomain found\r\n */\r\nexport async function getTenantId(): Promise<string | null> {\r\n  const headersList = await headers();\r\n  const host = headersList.get(\"host\") || headersList.get(\"x-forwarded-host\");\r\n\r\n  if (!host) {\r\n    return null;\r\n  }\r\n\r\n  // Remove port if present (e.g., \"localhost:3000\" â†’ \"localhost\")\r\n  const hostname = host.split(\":\")[0];\r\n\r\n  // Split by dots and get the first part (subdomain)\r\n  const parts = hostname.split(\".\");\r\n\r\n  // If we have more than 2 parts, the first is the subdomain\r\n  // e.g., \"kalitechnia.ftiaxesite.gr\" â†’ [\"kalitechnia\", \"ftiaxesite\", \"gr\"]\r\n  if (parts.length > 2) {\r\n    return parts[0];\r\n  }\r\n\r\n  // For localhost or single domain, return null\r\n  // You might want to handle localhost differently for development\r\n  if (hostname === \"localhost\" || hostname === \"127.0.0.1\") {\r\n    return null;\r\n  }\r\n\r\n  // If only 2 parts (e.g., \"ftiaxesite.gr\"), no subdomain\r\n  return null;\r\n}\r\n\r\n","\"use server\";\r\n\r\nimport { supabaseServer } from \"@/lib/supabase\";\r\nimport { getTenantId } from \"@/lib/tenant\";\r\nimport { getTenantIdForServerAction } from \"@/lib/tenant-server\";\r\nimport { revalidatePath } from \"next/cache\";\r\n\r\ninterface PageSections {\r\n  sections?: Array<{\r\n    type: string;\r\n    props: Record<string, any>;\r\n  }>;\r\n}\r\n\r\n/**\r\n * Get a page by ID for the current tenant\r\n */\r\nexport async function getPageById(pageId: string) {\r\n  try {\r\n    const tenantSlug = await getTenantId();\r\n    if (!tenantSlug) {\r\n      return { error: \"Tenant not found\" };\r\n    }\r\n\r\n    const supabase = supabaseServer();\r\n\r\n    // First, get the tenant ID\r\n    const { data: tenant, error: tenantError } = await supabase\r\n      .from(\"tenants\")\r\n      .select(\"id\")\r\n      .eq(\"slug\", tenantSlug)\r\n      .single();\r\n\r\n    if (tenantError || !tenant) {\r\n      return { error: \"Tenant not found\" };\r\n    }\r\n\r\n    // Get the page\r\n    const { data: page, error: pageError } = await supabase\r\n      .from(\"pages\")\r\n      .select(\"*\")\r\n      .eq(\"tenant_id\", tenant.id)\r\n      .eq(\"id\", pageId)\r\n      .single();\r\n\r\n    if (pageError) {\r\n      return { error: pageError.message };\r\n    }\r\n\r\n    // Get the latest version content if page exists\r\n    let content = null;\r\n    if (page) {\r\n      const { data: latestVersion } = await supabase\r\n        .from(\"page_versions\")\r\n        .select(\"content\")\r\n        .eq(\"page_id\", page.id)\r\n        .order(\"version_number\", { ascending: false })\r\n        .limit(1)\r\n        .single();\r\n\r\n      content = latestVersion?.content || null;\r\n    }\r\n\r\n    return { data: { ...page, content } };\r\n  } catch (error) {\r\n    return { error: error instanceof Error ? error.message : \"Unknown error\" };\r\n  }\r\n}\r\n\r\n/**\r\n * Get a page by slug for the current tenant\r\n */\r\nexport async function getPageBySlug(slug: string) {\r\n  try {\r\n    const tenantSlug = await getTenantId();\r\n    if (!tenantSlug) {\r\n      return { error: \"Tenant not found\" };\r\n    }\r\n\r\n    const supabase = supabaseServer();\r\n\r\n    // First, get the tenant ID\r\n    const { data: tenant, error: tenantError } = await supabase\r\n      .from(\"tenants\")\r\n      .select(\"id\")\r\n      .eq(\"slug\", tenantSlug)\r\n      .single();\r\n\r\n    if (tenantError || !tenant) {\r\n      return { error: \"Tenant not found\" };\r\n    }\r\n\r\n    // Get the page\r\n    const { data: page, error: pageError } = await supabase\r\n      .from(\"pages\")\r\n      .select(\"*\")\r\n      .eq(\"tenant_id\", tenant.id)\r\n      .eq(\"slug\", slug)\r\n      .single();\r\n\r\n    if (pageError) {\r\n      return { error: pageError.message };\r\n    }\r\n\r\n    // Get the latest version content if page exists\r\n    let content = null;\r\n    if (page) {\r\n      const { data: latestVersion } = await supabase\r\n        .from(\"page_versions\")\r\n        .select(\"content\")\r\n        .eq(\"page_id\", page.id)\r\n        .order(\"version_number\", { ascending: false })\r\n        .limit(1)\r\n        .single();\r\n\r\n      content = latestVersion?.content || null;\r\n    }\r\n\r\n    return { data: { ...page, content } };\r\n  } catch (error) {\r\n    return { error: error instanceof Error ? error.message : \"Unknown error\" };\r\n  }\r\n}\r\n\r\n/**\r\n * Save page sections and create a version snapshot\r\n */\r\nexport async function savePageSections(\r\n  pageId: string,\r\n  sections: PageSections[\"sections\"]\r\n) {\r\n  try {\r\n    const tenantSlug = await getTenantId();\r\n    if (!tenantSlug) {\r\n      return { error: \"Tenant not found\" };\r\n    }\r\n\r\n    const supabase = supabaseServer();\r\n\r\n    // Get tenant ID\r\n    const { data: tenant, error: tenantError } = await supabase\r\n      .from(\"tenants\")\r\n      .select(\"id\")\r\n      .eq(\"slug\", tenantSlug)\r\n      .single();\r\n\r\n    if (tenantError || !tenant) {\r\n      return { error: \"Tenant not found\" };\r\n    }\r\n\r\n    // Verify page belongs to tenant\r\n    const { data: page, error: pageError } = await supabase\r\n      .from(\"pages\")\r\n      .select(\"id, tenant_id\")\r\n      .eq(\"id\", pageId)\r\n      .eq(\"tenant_id\", tenant.id)\r\n      .single();\r\n\r\n    if (pageError || !page) {\r\n      return { error: \"Page not found\" };\r\n    }\r\n\r\n    // Get the highest version number\r\n    const { data: versions } = await supabase\r\n      .from(\"page_versions\")\r\n      .select(\"version_number\")\r\n      .eq(\"page_id\", pageId)\r\n      .order(\"version_number\", { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    const nextVersion = (versions?.version_number || 0) + 1;\r\n\r\n    // Create new version snapshot\r\n    const { data: version, error: versionError } = await supabase\r\n      .from(\"page_versions\")\r\n      .insert({\r\n        page_id: pageId,\r\n        tenant_id: tenant.id,\r\n        version_number: nextVersion,\r\n        content: { sections } as any,\r\n      })\r\n      .select()\r\n      .single();\r\n\r\n    if (versionError) {\r\n      return { error: versionError.message };\r\n    }\r\n\r\n    revalidatePath(\"/\");\r\n    return { data: version };\r\n  } catch (error) {\r\n    return { error: error instanceof Error ? error.message : \"Unknown error\" };\r\n  }\r\n}\r\n\r\n/**\r\n * Publish a page (set status to 'published')\r\n */\r\nexport async function publishPage(pageId: string, tenantDomain: string) {\r\n  const { error } = await supabaseServer()\r\n    .from(\"pages\")\r\n    .update({ status: \"published\" })\r\n    .eq(\"id\", pageId);\r\n\r\n  if (error) throw new Error(error.message);\r\n\r\n  // ðŸ”” Trigger Vercel revalidate\r\n  await fetch(`https://${tenantDomain}/api/revalidate`, {\r\n    method: \"POST\",\r\n    headers: { \"Content-Type\": \"application/json\" },\r\n    body: JSON.stringify({\r\n      secret: process.env.VERCEL_REVALIDATE_SECRET,\r\n      tenantDomain,\r\n    }),\r\n  }).catch(() => {});\r\n\r\n  return { ok: true };\r\n}\r\n\r\n/**\r\n * Set page back to draft status\r\n */\r\nexport async function setDraft(pageId: string) {\r\n  try {\r\n    const tenantSlug = await getTenantId();\r\n    if (!tenantSlug) {\r\n      return { error: \"Tenant not found\" };\r\n    }\r\n\r\n    const supabase = supabaseServer();\r\n\r\n    // Get tenant ID\r\n    const { data: tenant, error: tenantError } = await supabase\r\n      .from(\"tenants\")\r\n      .select(\"id\")\r\n      .eq(\"slug\", tenantSlug)\r\n      .single();\r\n\r\n    if (tenantError || !tenant) {\r\n      return { error: \"Tenant not found\" };\r\n    }\r\n\r\n    // Verify page belongs to tenant and update\r\n    const { data: updatedPage, error: updateError } = await supabase\r\n      .from(\"pages\")\r\n      .update({ status: \"draft\" })\r\n      .eq(\"id\", pageId)\r\n      .eq(\"tenant_id\", tenant.id)\r\n      .select()\r\n      .single();\r\n\r\n    if (updateError) {\r\n      return { error: updateError.message };\r\n    }\r\n\r\n    revalidatePath(\"/\");\r\n    return { data: updatedPage };\r\n  } catch (error) {\r\n    return { error: error instanceof Error ? error.message : \"Unknown error\" };\r\n  }\r\n}\r\n\r\n/**\r\n * Clone a page (duplicate with new slug)\r\n */\r\nexport async function clonePage(pageId: string, newSlug: string, newTitle?: string) {\r\n  try {\r\n    const tenantSlug = await getTenantId();\r\n    if (!tenantSlug) {\r\n      return { error: \"Tenant not found\" };\r\n    }\r\n\r\n    const supabase = supabaseServer();\r\n\r\n    // Get tenant ID\r\n    const { data: tenant, error: tenantError } = await supabase\r\n      .from(\"tenants\")\r\n      .select(\"id\")\r\n      .eq(\"slug\", tenantSlug)\r\n      .single();\r\n\r\n    if (tenantError || !tenant) {\r\n      return { error: \"Tenant not found\" };\r\n    }\r\n\r\n    // Get original page\r\n    const { data: originalPage, error: pageError } = await supabase\r\n      .from(\"pages\")\r\n      .select(\"*\")\r\n      .eq(\"id\", pageId)\r\n      .eq(\"tenant_id\", tenant.id)\r\n      .single();\r\n\r\n    if (pageError || !originalPage) {\r\n      return { error: \"Page not found\" };\r\n    }\r\n\r\n    // Get latest version of original page\r\n    const { data: latestVersion } = await supabase\r\n      .from(\"page_versions\")\r\n      .select(\"content\")\r\n      .eq(\"page_id\", pageId)\r\n      .order(\"version_number\", { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    // Create new page\r\n    const { data: newPage, error: createError } = await supabase\r\n      .from(\"pages\")\r\n      .insert({\r\n        tenant_id: tenant.id,\r\n        slug: newSlug,\r\n        title: newTitle || `${originalPage.title} (Copy)`,\r\n        status: \"draft\",\r\n      })\r\n      .select()\r\n      .single();\r\n\r\n    if (createError) {\r\n      return { error: createError.message };\r\n    }\r\n\r\n    // Create initial version for cloned page\r\n    if (latestVersion) {\r\n      await supabase.from(\"page_versions\").insert({\r\n        page_id: newPage.id,\r\n        tenant_id: tenant.id,\r\n        version_number: 1,\r\n        content: latestVersion.content,\r\n      });\r\n    }\r\n\r\n    revalidatePath(\"/\");\r\n    return { data: newPage };\r\n  } catch (error) {\r\n    return { error: error instanceof Error ? error.message : \"Unknown error\" };\r\n  }\r\n}\r\n\r\n/**\r\n * List all versions for a page\r\n */\r\nexport async function listVersions(pageId: string) {\r\n  try {\r\n    const tenantSlug = await getTenantId();\r\n    if (!tenantSlug) {\r\n      return { error: \"Tenant not found\" };\r\n    }\r\n\r\n    const supabase = supabaseServer();\r\n\r\n    // Get tenant ID\r\n    const { data: tenant, error: tenantError } = await supabase\r\n      .from(\"tenants\")\r\n      .select(\"id\")\r\n      .eq(\"slug\", tenantSlug)\r\n      .single();\r\n\r\n    if (tenantError || !tenant) {\r\n      return { error: \"Tenant not found\" };\r\n    }\r\n\r\n    // Verify page belongs to tenant\r\n    const { data: page, error: pageError } = await supabase\r\n      .from(\"pages\")\r\n      .select(\"id\")\r\n      .eq(\"id\", pageId)\r\n      .eq(\"tenant_id\", tenant.id)\r\n      .single();\r\n\r\n    if (pageError || !page) {\r\n      return { error: \"Page not found\" };\r\n    }\r\n\r\n    // Get all versions\r\n    const { data: versions, error: versionsError } = await supabase\r\n      .from(\"page_versions\")\r\n      .select(\"*\")\r\n      .eq(\"page_id\", pageId)\r\n      .order(\"version_number\", { ascending: false });\r\n\r\n    if (versionsError) {\r\n      return { error: versionsError.message };\r\n    }\r\n\r\n    return { data: versions || [] };\r\n  } catch (error) {\r\n    return { error: error instanceof Error ? error.message : \"Unknown error\" };\r\n  }\r\n}\r\n\r\n/**\r\n * Create a new page\r\n */\r\nexport async function createPage(data: { title: string; slug: string }) {\r\n  try {\r\n    const tenantId = await getTenantIdForServerAction();\r\n    if (!tenantId) {\r\n      return { error: \"Tenant not found\" };\r\n    }\r\n\r\n    const supabase = supabaseServer();\r\n\r\n    // Create new page\r\n    const { data: newPage, error: createError } = await supabase\r\n      .from(\"pages\")\r\n      .insert({\r\n        tenant_id: tenantId,\r\n        title: data.title,\r\n        slug: data.slug,\r\n        status: \"draft\",\r\n      })\r\n      .select()\r\n      .single();\r\n\r\n    if (createError) {\r\n      return { error: createError.message };\r\n    }\r\n\r\n    // Create initial version\r\n    await supabase.from(\"page_versions\").insert({\r\n      page_id: newPage.id,\r\n      tenant_id: tenantId,\r\n      version_number: 1,\r\n      content: { sections: [] },\r\n    });\r\n\r\n    revalidatePath(\"/\");\r\n    return { data: newPage };\r\n  } catch (error) {\r\n    return { error: error instanceof Error ? error.message : \"Unknown error\" };\r\n  }\r\n}\r\n\r\n/**\r\n * List all pages for the current tenant\r\n */\r\nexport async function listPages() {\r\n  try {\r\n    const tenantId = await getTenantIdForServerAction();\r\n    if (!tenantId) {\r\n      return { error: \"Tenant not found\" };\r\n    }\r\n\r\n    const supabase = supabaseServer();\r\n\r\n    // Get all pages for tenant\r\n    const { data: pages, error: pagesError } = await supabase\r\n      .from(\"pages\")\r\n      .select(\"id, title, slug, status, updated_at\")\r\n      .eq(\"tenant_id\", tenantId)\r\n      .order(\"updated_at\", { ascending: false });\r\n\r\n    if (pagesError) {\r\n      return { error: pagesError.message };\r\n    }\r\n\r\n    return { data: pages || [] };\r\n  } catch (error) {\r\n    return { error: error instanceof Error ? error.message : \"Unknown error\" };\r\n  }\r\n}\r\n\r\n/**\r\n * Restore a specific version (create new version from old one)\r\n */\r\nexport async function restoreVersion(pageId: string, versionId: string) {\r\n  try {\r\n    const tenantSlug = await getTenantId();\r\n    if (!tenantSlug) {\r\n      return { error: \"Tenant not found\" };\r\n    }\r\n\r\n    const supabase = supabaseServer();\r\n\r\n    // Get tenant ID\r\n    const { data: tenant, error: tenantError } = await supabase\r\n      .from(\"tenants\")\r\n      .select(\"id\")\r\n      .eq(\"slug\", tenantSlug)\r\n      .single();\r\n\r\n    if (tenantError || !tenant) {\r\n      return { error: \"Tenant not found\" };\r\n    }\r\n\r\n    // Verify page belongs to tenant\r\n    const { data: page, error: pageError } = await supabase\r\n      .from(\"pages\")\r\n      .select(\"id\")\r\n      .eq(\"id\", pageId)\r\n      .eq(\"tenant_id\", tenant.id)\r\n      .single();\r\n\r\n    if (pageError || !page) {\r\n      return { error: \"Page not found\" };\r\n    }\r\n\r\n    // Get the version to restore\r\n    const { data: versionToRestore, error: versionError } = await supabase\r\n      .from(\"page_versions\")\r\n      .select(\"*\")\r\n      .eq(\"id\", versionId)\r\n      .eq(\"page_id\", pageId)\r\n      .single();\r\n\r\n    if (versionError || !versionToRestore) {\r\n      return { error: \"Version not found\" };\r\n    }\r\n\r\n    // Get the highest version number\r\n    const { data: versions } = await supabase\r\n      .from(\"page_versions\")\r\n      .select(\"version_number\")\r\n      .eq(\"page_id\", pageId)\r\n      .order(\"version_number\", { ascending: false })\r\n      .limit(1)\r\n      .single();\r\n\r\n    const nextVersion = (versions?.version_number || 0) + 1;\r\n\r\n    // Create new version from restored content\r\n    const { data: newVersion, error: createError } = await supabase\r\n      .from(\"page_versions\")\r\n      .insert({\r\n        page_id: pageId,\r\n        tenant_id: tenant.id,\r\n        version_number: nextVersion,\r\n        content: versionToRestore.content,\r\n        meta: {\r\n          ...versionToRestore.meta,\r\n          restored_from: versionId,\r\n          restored_at: new Date().toISOString(),\r\n        },\r\n      })\r\n      .select()\r\n      .single();\r\n\r\n    if (createError) {\r\n      return { error: createError.message };\r\n    }\r\n\r\n    revalidatePath(\"/\");\r\n    return { data: newVersion };\r\n  } catch (error) {\r\n    return { error: error instanceof Error ? error.message : \"Unknown error\" };\r\n  }\r\n}\r\n\r\n","export {listPages as '00b2946ef30aacf41c89fa495e7737407fc4507ff5'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":"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"}