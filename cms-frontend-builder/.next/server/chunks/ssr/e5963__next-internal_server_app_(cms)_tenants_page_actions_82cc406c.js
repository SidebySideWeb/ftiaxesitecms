module.exports=[67548,a=>{"use strict";var b=a.i(64898),c=a.i(80494),d=a.i(93879),e=a.i(34445);a.i(52434);var f=a.i(13422);async function g(a){try{let b=(0,c.supabaseServer)(),{data:d,error:e}=await b.from("tenants").select("id, name, slug, created_at").or(`slug.eq.${a},id.eq.${a}`).single();if(e||!d)return{error:"Tenant not found"};let{data:f}=await b.from("globals").select("value").eq("tenant_id",d.id).eq("key","settings").maybeSingle(),g=f?.value,h=g?.domain||"",i=g?.primaryColor||"#6366f1",j=g?.defaultLocale||"en";return{data:{...d,domain:h,brandColor:i,defaultLocale:j}}}catch(a){return{error:a instanceof Error?a.message:"Unknown error"}}}async function h(a,b){try{let g=await (0,e.cookies)(),h=(0,f.createServerClient)("https://qgisnksjztjczsrbjryr.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFnaXNua3NqenRqY3pzcmJqcnlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwNTI0ODcsImV4cCI6MjA4MDYyODQ4N30.B9j69ZAWHxEKvgJC0B_4iVtj45h2USfbWWssIQCx_DA",{cookies:{get:a=>g.get(a)?.value,set(a,b,c){try{g.set(a,b,c)}catch(a){}},remove(a,b){try{g.set(a,"",{...b,maxAge:0})}catch(a){}}}}),{data:{user:i},error:j}=await h.auth.getUser();if(j||!i)return{error:"Unauthorized. Please log in."};let k=(0,c.supabaseServer)(),{data:l}=await k.from("tenant_users").select("role").eq("tenant_id",a).eq("user_id",i.id).single();if(!l)return{error:"Forbidden. You don't have access to this tenant."};if(b.name){let{error:c}=await k.from("tenants").update({name:b.name.trim()}).eq("id",a);if(c)return{error:c.message}}let{data:m}=await k.from("globals").select("value").eq("tenant_id",a).eq("key","settings").maybeSingle(),n={...m?.value||{},...b.domain&&{domain:b.domain.trim()},...b.brandColor&&{primaryColor:b.brandColor},...b.defaultLocale&&{defaultLocale:b.defaultLocale}},{error:o}=await k.from("globals").upsert({tenant_id:a,key:"settings",value:n,status:"published"},{onConflict:"tenant_id,key"});if(o)return{error:o.message};return(0,d.revalidatePath)("/tenants"),(0,d.revalidatePath)(`/tenants/${a}/edit`),{success:!0}}catch(a){return{error:a instanceof Error?a.message:"Unknown error"}}}async function i(a){try{let b=await (0,e.cookies)(),g=(0,f.createServerClient)("https://qgisnksjztjczsrbjryr.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFnaXNua3NqenRqY3pzcmJqcnlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwNTI0ODcsImV4cCI6MjA4MDYyODQ4N30.B9j69ZAWHxEKvgJC0B_4iVtj45h2USfbWWssIQCx_DA",{cookies:{get:a=>b.get(a)?.value,set(a,c,d){try{b.set(a,c,d)}catch(a){}},remove(a,c){try{b.set(a,"",{...c,maxAge:0})}catch(a){}}}}),{data:{user:h},error:i}=await g.auth.getUser();if(i||!h)return{error:"Unauthorized. Please log in."};let j=(0,c.supabaseServer)(),{data:k}=await j.from("tenant_users").select("role").eq("tenant_id",a).eq("user_id",h.id).single();if(!k||!["owner","admin"].includes(k.role))return{error:"Forbidden. Only owners and admins can delete tenants."};let{error:l}=await j.from("tenants").delete().eq("id",a);if(l)return{error:l.message};return(0,d.revalidatePath)("/tenants"),{success:!0}}catch(a){return{error:a instanceof Error?a.message:"Unknown error"}}}async function j(a){try{let b=await (0,e.cookies)(),g=(0,f.createServerClient)("https://qgisnksjztjczsrbjryr.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFnaXNua3NqenRqY3pzcmJqcnlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwNTI0ODcsImV4cCI6MjA4MDYyODQ4N30.B9j69ZAWHxEKvgJC0B_4iVtj45h2USfbWWssIQCx_DA",{cookies:{get:a=>b.get(a)?.value,set(a,c,d){try{b.set(a,c,d)}catch(a){}},remove(a,c){try{b.set(a,"",{...c,maxAge:0})}catch(a){}}}}),{data:{user:h},error:i}=await g.auth.getUser();if(i||!h)return{error:"Unauthorized. Please log in."};let j=(0,c.supabaseServer)(),k=a.name.toLowerCase().trim().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),{data:l}=await j.from("tenants").select("id, slug").eq("slug",k).single();if(l)return{error:`Tenant with name "${a.name}" already exists`};let{data:m,error:n}=await j.from("tenants").insert({name:a.name.trim(),slug:k}).select().single();if(n)return{error:n.message};let{error:o}=await j.from("tenant_users").insert({tenant_id:m.id,user_id:h.id,role:"owner"});if(o)return await j.from("tenants").delete().eq("id",m.id),{error:o.message};let{error:p}=await j.from("globals").upsert({tenant_id:m.id,key:"settings",value:{domain:a.domain.trim(),primaryColor:a.brandColor||"#0d9488",defaultLocale:"el"},status:"published"},{onConflict:"tenant_id,key"});return p&&console.error("Error creating default settings:",p),(0,d.revalidatePath)("/tenants"),{success:!0,id:m.id}}catch(a){return{error:a instanceof Error?a.message:"Unknown error"}}}async function k(a,b="owner"){try{let g=await (0,e.cookies)(),h=(0,f.createServerClient)("https://qgisnksjztjczsrbjryr.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFnaXNua3NqenRqY3pzcmJqcnlyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUwNTI0ODcsImV4cCI6MjA4MDYyODQ4N30.B9j69ZAWHxEKvgJC0B_4iVtj45h2USfbWWssIQCx_DA",{cookies:{get:a=>g.get(a)?.value,set(a,b,c){try{g.set(a,b,c)}catch(a){}},remove(a,b){try{g.set(a,"",{...b,maxAge:0})}catch(a){}}}}),{data:{user:i},error:j}=await h.auth.getUser();if(j||!i)return{error:"Unauthorized. Please log in."};let k=(0,c.supabaseServer)(),{data:l,error:m}=await k.from("tenants").select("id").or(`slug.eq.${a},id.eq.${a}`).single();if(m||!l)return{error:"Tenant not found"};let{data:n}=await k.from("tenant_users").select("id").eq("tenant_id",l.id).eq("user_id",i.id).maybeSingle();if(n)return{success:!0,message:"User is already linked to this tenant"};let{error:o}=await k.from("tenant_users").insert({tenant_id:l.id,user_id:i.id,role:b});if(o)return{error:`Failed to link user to tenant: ${o.message}`};return(0,d.revalidatePath)("/tenants"),{success:!0,message:"User linked to tenant successfully"}}catch(a){return{error:a instanceof Error?a.message:"Unknown error"}}}(0,a.i(57097).ensureServerEntryExports)([g,h,i,j,k]),(0,b.registerServerReference)(g,"404490fb840fa09892d828dd0fe392e78d10eb508f",null),(0,b.registerServerReference)(h,"60b5be76064c27874ad91f5ab38c0999e268e953ae",null),(0,b.registerServerReference)(i,"40b4a5b2050e544c277446f15da4cb92220f187868",null),(0,b.registerServerReference)(j,"40a0a7d44f91bc91a3e9afac09b7ee500da88235e6",null),(0,b.registerServerReference)(k,"60fe34dcc37d4ea1d46459bcd24fedc526841f2e1a",null),a.s([],13695),a.i(13695),a.s(["40a0a7d44f91bc91a3e9afac09b7ee500da88235e6",()=>j,"60fe34dcc37d4ea1d46459bcd24fedc526841f2e1a",()=>k],67548)}];

//# sourceMappingURL=e5963__next-internal_server_app_%28cms%29_tenants_page_actions_82cc406c.js.map