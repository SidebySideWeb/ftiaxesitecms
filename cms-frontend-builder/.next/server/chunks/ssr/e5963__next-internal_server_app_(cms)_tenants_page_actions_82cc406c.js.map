{"version":3,"sources":["../../../../../src/actions/tenants.ts"],"sourcesContent":["\"use server\";\r\n\r\nimport { supabaseServer } from \"@/lib/supabase\";\r\nimport { revalidatePath } from \"next/cache\";\r\nimport { cookies } from \"next/headers\";\r\nimport { createServerClient } from \"@supabase/ssr\";\r\n\r\nexport interface CreateTenantData {\r\n  id: string; // slug/id (lowercase)\r\n  name: string;\r\n  domain: string;\r\n  primaryColor?: string;\r\n  defaultLocale?: string;\r\n}\r\n\r\n/**\r\n * Get a tenant by ID or slug\r\n */\r\nexport async function getTenantById(tenantIdOrSlug: string) {\r\n  try {\r\n    const supabase = supabaseServer();\r\n\r\n    // Try to find by slug first, then by ID\r\n    const { data: tenant, error } = await supabase\r\n      .from(\"tenants\")\r\n      .select(\"id, name, slug, created_at\")\r\n      .or(`slug.eq.${tenantIdOrSlug},id.eq.${tenantIdOrSlug}`)\r\n      .single();\r\n\r\n    if (error || !tenant) {\r\n      return { error: \"Tenant not found\" };\r\n    }\r\n\r\n    // Get domain and settings from globals\r\n    const { data: settings } = await supabase\r\n      .from(\"globals\")\r\n      .select(\"value\")\r\n      .eq(\"tenant_id\", tenant.id)\r\n      .eq(\"key\", \"settings\")\r\n      .maybeSingle();\r\n\r\n    const settingsValue = settings?.value as any;\r\n    const domain = settingsValue?.domain || \"\";\r\n    const brandColor = settingsValue?.primaryColor || \"#6366f1\";\r\n    const defaultLocale = settingsValue?.defaultLocale || \"en\";\r\n\r\n    return {\r\n      data: {\r\n        ...tenant,\r\n        domain,\r\n        brandColor,\r\n        defaultLocale,\r\n      },\r\n    };\r\n  } catch (error) {\r\n    return { error: error instanceof Error ? error.message : \"Unknown error\" };\r\n  }\r\n}\r\n\r\n/**\r\n * Update tenant settings\r\n */\r\nexport async function updateTenant(\r\n  tenantId: string,\r\n  data: {\r\n    name?: string;\r\n    domain?: string;\r\n    brandColor?: string;\r\n    defaultLocale?: string;\r\n  }\r\n) {\r\n  try {\r\n    // Get current user to verify access\r\n    const cookieStore = await cookies();\r\n    const supabase = createServerClient(\r\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n      {\r\n        cookies: {\r\n          get(name: string) {\r\n            return cookieStore.get(name)?.value;\r\n          },\r\n          set(name: string, value: string, options: any) {\r\n            try {\r\n              cookieStore.set(name, value, options);\r\n            } catch (error) {\r\n              // Ignore cookie setting errors in server actions\r\n            }\r\n          },\r\n          remove(name: string, options: any) {\r\n            try {\r\n              cookieStore.set(name, \"\", { ...options, maxAge: 0 });\r\n            } catch (error) {\r\n              // Ignore cookie removal errors in server actions\r\n            }\r\n          },\r\n        },\r\n      }\r\n    );\r\n\r\n    const { data: { user }, error: userError } = await supabase.auth.getUser();\r\n\r\n    if (userError || !user) {\r\n      return { error: \"Unauthorized. Please log in.\" };\r\n    }\r\n\r\n    // Verify user has access to this tenant\r\n    const adminSupabase = supabaseServer();\r\n    const { data: tenantUser } = await adminSupabase\r\n      .from(\"tenant_users\")\r\n      .select(\"role\")\r\n      .eq(\"tenant_id\", tenantId)\r\n      .eq(\"user_id\", user.id)\r\n      .single();\r\n\r\n    if (!tenantUser) {\r\n      return { error: \"Forbidden. You don't have access to this tenant.\" };\r\n    }\r\n\r\n    // Update tenant name if provided\r\n    if (data.name) {\r\n      const { error: updateError } = await adminSupabase\r\n        .from(\"tenants\")\r\n        .update({ name: data.name.trim() })\r\n        .eq(\"id\", tenantId);\r\n\r\n      if (updateError) {\r\n        return { error: updateError.message };\r\n      }\r\n    }\r\n\r\n    // Update settings in globals\r\n    const { data: existingSettings } = await adminSupabase\r\n      .from(\"globals\")\r\n      .select(\"value\")\r\n      .eq(\"tenant_id\", tenantId)\r\n      .eq(\"key\", \"settings\")\r\n      .maybeSingle();\r\n\r\n    const currentSettings = (existingSettings?.value as any) || {};\r\n    const updatedSettings = {\r\n      ...currentSettings,\r\n      ...(data.domain && { domain: data.domain.trim() }),\r\n      ...(data.brandColor && { primaryColor: data.brandColor }),\r\n      ...(data.defaultLocale && { defaultLocale: data.defaultLocale }),\r\n    };\r\n\r\n    const { error: globalsError } = await adminSupabase\r\n      .from(\"globals\")\r\n      .upsert(\r\n        {\r\n          tenant_id: tenantId,\r\n          key: \"settings\",\r\n          value: updatedSettings,\r\n          status: \"published\",\r\n        },\r\n        {\r\n          onConflict: \"tenant_id,key\",\r\n        }\r\n      );\r\n\r\n    if (globalsError) {\r\n      return { error: globalsError.message };\r\n    }\r\n\r\n    revalidatePath(\"/tenants\");\r\n    revalidatePath(`/tenants/${tenantId}/edit`);\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { error: error instanceof Error ? error.message : \"Unknown error\" };\r\n  }\r\n}\r\n\r\n/**\r\n * Delete a tenant\r\n */\r\nexport async function deleteTenant(tenantId: string) {\r\n  try {\r\n    // Get current user to verify access\r\n    const cookieStore = await cookies();\r\n    const supabase = createServerClient(\r\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n      {\r\n        cookies: {\r\n          get(name: string) {\r\n            return cookieStore.get(name)?.value;\r\n          },\r\n          set(name: string, value: string, options: any) {\r\n            try {\r\n              cookieStore.set(name, value, options);\r\n            } catch (error) {\r\n              // Ignore cookie setting errors in server actions\r\n            }\r\n          },\r\n          remove(name: string, options: any) {\r\n            try {\r\n              cookieStore.set(name, \"\", { ...options, maxAge: 0 });\r\n            } catch (error) {\r\n              // Ignore cookie removal errors in server actions\r\n            }\r\n          },\r\n        },\r\n      }\r\n    );\r\n\r\n    const { data: { user }, error: userError } = await supabase.auth.getUser();\r\n\r\n    if (userError || !user) {\r\n      return { error: \"Unauthorized. Please log in.\" };\r\n    }\r\n\r\n    // Verify user is owner or admin\r\n    const adminSupabase = supabaseServer();\r\n    const { data: tenantUser } = await adminSupabase\r\n      .from(\"tenant_users\")\r\n      .select(\"role\")\r\n      .eq(\"tenant_id\", tenantId)\r\n      .eq(\"user_id\", user.id)\r\n      .single();\r\n\r\n    if (!tenantUser || ![\"owner\", \"admin\"].includes(tenantUser.role)) {\r\n      return { error: \"Forbidden. Only owners and admins can delete tenants.\" };\r\n    }\r\n\r\n    // Delete tenant (cascade will handle related records)\r\n    const { error: deleteError } = await adminSupabase\r\n      .from(\"tenants\")\r\n      .delete()\r\n      .eq(\"id\", tenantId);\r\n\r\n    if (deleteError) {\r\n      return { error: deleteError.message };\r\n    }\r\n\r\n    revalidatePath(\"/tenants\");\r\n    return { success: true };\r\n  } catch (error) {\r\n    return { error: error instanceof Error ? error.message : \"Unknown error\" };\r\n  }\r\n}\r\n\r\n/**\r\n * Create a new tenant (simplified interface for frontend)\r\n */\r\nexport async function createTenant(data: {\r\n  name: string;\r\n  domain: string;\r\n  brandColor?: string;\r\n}) {\r\n  try {\r\n    // Get current user to link them as owner\r\n    const cookieStore = await cookies();\r\n    const supabase = createServerClient(\r\n      process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n      process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n      {\r\n        cookies: {\r\n          get(name: string) {\r\n            return cookieStore.get(name)?.value;\r\n          },\r\n          set(name: string, value: string, options: any) {\r\n            try {\r\n              cookieStore.set(name, value, options);\r\n            } catch (error) {\r\n              // Ignore cookie setting errors in server actions\r\n            }\r\n          },\r\n          remove(name: string, options: any) {\r\n            try {\r\n              cookieStore.set(name, \"\", { ...options, maxAge: 0 });\r\n            } catch (error) {\r\n              // Ignore cookie removal errors in server actions\r\n            }\r\n          },\r\n        },\r\n      }\r\n    );\r\n\r\n    const { data: { user }, error: userError } = await supabase.auth.getUser();\r\n\r\n    if (userError || !user) {\r\n      return { error: \"Unauthorized. Please log in.\" };\r\n    }\r\n\r\n    const adminSupabase = supabaseServer();\r\n    \r\n    // Generate slug from name\r\n    const slug = data.name\r\n      .toLowerCase()\r\n      .trim()\r\n      .replace(/[^a-z0-9]+/g, \"-\")\r\n      .replace(/^-+|-+$/g, \"\");\r\n\r\n    // Check if tenant slug already exists\r\n    const { data: existingTenant } = await adminSupabase\r\n      .from(\"tenants\")\r\n      .select(\"id, slug\")\r\n      .eq(\"slug\", slug)\r\n      .single();\r\n\r\n    if (existingTenant) {\r\n      return { error: `Tenant with name \"${data.name}\" already exists` };\r\n    }\r\n\r\n    // Create tenant\r\n    const { data: newTenant, error: tenantError } = await adminSupabase\r\n      .from(\"tenants\")\r\n      .insert({\r\n        name: data.name.trim(),\r\n        slug: slug,\r\n      })\r\n      .select()\r\n      .single();\r\n\r\n    if (tenantError) {\r\n      return { error: tenantError.message };\r\n    }\r\n\r\n    // Link user as owner\r\n    const { error: linkError } = await adminSupabase\r\n      .from(\"tenant_users\")\r\n      .insert({\r\n        tenant_id: newTenant.id,\r\n        user_id: user.id,\r\n        role: \"owner\",\r\n      });\r\n\r\n    if (linkError) {\r\n      // If link fails, try to clean up the tenant\r\n      await adminSupabase.from(\"tenants\").delete().eq(\"id\", newTenant.id);\r\n      return { error: linkError.message };\r\n    }\r\n\r\n    // Create default settings in globals\r\n    const { error: globalsError } = await adminSupabase\r\n      .from(\"globals\")\r\n      .upsert(\r\n        {\r\n          tenant_id: newTenant.id,\r\n          key: \"settings\",\r\n          value: {\r\n            domain: data.domain.trim(),\r\n            primaryColor: data.brandColor || \"#0d9488\",\r\n            defaultLocale: \"el\",\r\n          },\r\n          status: \"published\",\r\n        },\r\n        {\r\n          onConflict: \"tenant_id,key\",\r\n        }\r\n      );\r\n\r\n    if (globalsError) {\r\n      console.error(\"Error creating default settings:\", globalsError);\r\n      // Don't fail the whole operation if globals fail\r\n    }\r\n\r\n    revalidatePath(\"/tenants\");\r\n    return { success: true, id: newTenant.id };\r\n  } catch (error) {\r\n    return { error: error instanceof Error ? error.message : \"Unknown error\" };\r\n  }\r\n}\r\n\r\n/**\r\n * Link the current user to an existing tenant\r\n * Useful if a tenant exists but the user isn't linked to it\r\n */\r\nexport async function linkUserToTenant(tenantIdOrSlug: string, role: string = \"owner\") {\r\n  try {\r\n    const cookieStore = await cookies();\r\n    const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\r\n    const supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\r\n\r\n    const supabase = createServerClient(supabaseUrl, supabaseAnonKey, {\r\n      cookies: {\r\n        get(name: string) {\r\n          return cookieStore.get(name)?.value;\r\n        },\r\n        set(name: string, value: string, options: any) {\r\n          try {\r\n            cookieStore.set(name, value, options);\r\n          } catch (error) {\r\n            // Ignore cookie setting errors in server actions\r\n          }\r\n        },\r\n        remove(name: string, options: any) {\r\n          try {\r\n            cookieStore.set(name, \"\", { ...options, maxAge: 0 });\r\n          } catch (error) {\r\n            // Ignore cookie removal errors in server actions\r\n          }\r\n        },\r\n      },\r\n    });\r\n\r\n    const { data: { user }, error: userError } = await supabase.auth.getUser();\r\n\r\n    if (userError || !user) {\r\n      return { error: \"Unauthorized. Please log in.\" };\r\n    }\r\n\r\n    const adminSupabase = supabaseServer();\r\n\r\n    // Find tenant by slug or ID\r\n    const { data: tenant, error: tenantError } = await adminSupabase\r\n      .from(\"tenants\")\r\n      .select(\"id\")\r\n      .or(`slug.eq.${tenantIdOrSlug},id.eq.${tenantIdOrSlug}`)\r\n      .single();\r\n\r\n    if (tenantError || !tenant) {\r\n      return { error: \"Tenant not found\" };\r\n    }\r\n\r\n    // Check if link already exists\r\n    const { data: existingLink } = await adminSupabase\r\n      .from(\"tenant_users\")\r\n      .select(\"id\")\r\n      .eq(\"tenant_id\", tenant.id)\r\n      .eq(\"user_id\", user.id)\r\n      .maybeSingle();\r\n\r\n    if (existingLink) {\r\n      return { success: true, message: \"User is already linked to this tenant\" };\r\n    }\r\n\r\n    // Create the link\r\n    const { error: linkError } = await adminSupabase\r\n      .from(\"tenant_users\")\r\n      .insert({\r\n        tenant_id: tenant.id,\r\n        user_id: user.id,\r\n        role,\r\n      });\r\n\r\n    if (linkError) {\r\n      return { error: `Failed to link user to tenant: ${linkError.message}` };\r\n    }\r\n\r\n    revalidatePath(\"/tenants\");\r\n    return { success: true, message: \"User linked to tenant successfully\" };\r\n  } catch (error) {\r\n    return { error: error instanceof Error ? error.message : \"Unknown error\" };\r\n  }\r\n}"],"names":[],"mappings":"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"}